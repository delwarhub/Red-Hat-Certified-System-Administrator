Below are **clean, exam-style, step-by-step solutions** for every Firewalld & Security task.
These are *exactly* the commands and workflow you should use on the RHCSA exam ‚Äî concise, correct, and immediately verifiable.

---

# üîµ **1. Open a port permanently and reload firewall rules**

### **Example:** Open TCP port **8080**

### **Steps**

```bash
sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --reload
```

### **Verify**

```bash
sudo firewall-cmd --list-ports
```

Expected:
`8080/tcp`

---

# üîµ **2. Allow a predefined service (http, ssh, etc.) through firewalld**

### **Example:** Allow HTTP service

### **Steps**

```bash
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --reload
```

### **Verify**

```bash
sudo firewall-cmd --list-services
```

Expected:
`http` included in list.

---

# üîµ **3. Create and enable a rich rule allowing a specific IP**

### **Example:** Allow IP `10.10.10.50` to access port 22 (SSH)

### **Steps**

```bash
sudo firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="10.10.10.50" port protocol="tcp" port="22" accept'
sudo firewall-cmd --reload
```

### **Verify**

```bash
sudo firewall-cmd --list-rich-rules
```

---

# üîµ **4. Configure SSH so:**

* **root login is disabled**
* **password authentication is optional** (allowed or denied depending on your policy)

All done in the sshd config file.

---

## **Steps**

Open the SSH configuration file:

```bash
sudo nano /etc/ssh/sshd_config
```

Modify / ensure these lines exist:

### **Disable root login**

```
PermitRootLogin no
```

### **Allow password authentication (optional)**

To allow:

```
PasswordAuthentication yes
```

To disable:

```
PasswordAuthentication no
```

(*RHCSA typically wants you to *set* either value, not guess.*)

Save the file.

### **Restart SSH service**

```bash
sudo systemctl restart sshd
```

### **Optional: enable at boot**

```bash
sudo systemctl enable sshd
```

---

## **Verify**

View running config:

```bash
sudo sshd -T | grep -E 'permitrootlogin|passwordauthentication'
```

Should show:

```
permitrootlogin no
passwordauthentication yes/no
```

---

# üü¢ **Quick RHCSA Firewalld Cheat Sheet**

| Task           | Command                                                             |
| -------------- | ------------------------------------------------------------------- |
| Open port      | `firewall-cmd --permanent --add-port=8080/tcp`                      |
| Add service    | `firewall-cmd --permanent --add-service=http`                       |
| Reload         | `firewall-cmd --reload`                                             |
| List services  | `firewall-cmd --list-services`                                      |
| Rich rule      | `firewall-cmd --permanent --add-rich-rule='rule family="ipv4" ...'` |
| Root login off | `PermitRootLogin no` in sshd_config                                 |
| Restart SSH    | `systemctl restart sshd`                                            |

---

Below you‚Äôll find **three advanced RHCSA-style security exercises**:

1Ô∏è‚É£ A **Firewalld + SELinux combined exam scenario**
2Ô∏è‚É£ A **Security troubleshooting challenge**
3Ô∏è‚É£ A **10-minute mastery drill**

All three are designed to simulate the *difficulty, style, and pressure* of real RHCSA exam problems.

---

# üî• **1Ô∏è‚É£ Firewalld + SELinux Combined Exam Scenario**

Your company is deploying a custom web application on a RHEL server.
Apache must serve files from a custom directory, and access must be restricted based on source networks.
You must configure **Firewalld** and **SELinux** so everything works cleanly.

---

# **üî∑ Scenario Requirements**

## **A. Application directory**

* Create `/srv/appdata`
* Apache must read files from this directory
* Set correct **SELinux context** so Apache can serve content
* SELinux must remain **Enforcing**

## **B. Firewall requirements**

* Only allow HTTP access (**port 80**) from network `10.20.30.0/24`
* Block HTTP from all other networks
* SSH must remain open to everyone

## **C. Verification**

* Browsing from 10.20.30.x ‚Üí allowed
* Browsing from anywhere else ‚Üí blocked
* `getenforce` ‚Üí Enforcing

---

# **‚úî Step-by-Step Expected Solution**

## **A. Configure application directory for Apache**

Create directory:

```bash
mkdir -p /srv/appdata
```

Place an index page:

```bash
echo "Welcome to the exam app" > /srv/appdata/index.html
```

Give SELinux httpd read context:

```bash
semanage fcontext -a -t httpd_sys_content_t "/srv/appdata(/.*)?"
restorecon -Rv /srv/appdata
```

Verify:

```bash
ls -Zd /srv/appdata
```

Update Apache config (if needed):

```bash
sed -i 's|DocumentRoot .*|DocumentRoot "/srv/appdata"|' /etc/httpd/conf/httpd.conf
```

Start and enable Apache:

```bash
systemctl enable --now httpd
```

---

## **B. Firewalld rules**

Remove default http service:

```bash
firewall-cmd --permanent --remove-service=http
```

Allow HTTP only from 10.20.30.0/24:

```bash
firewall-cmd --permanent \
  --add-rich-rule='rule family="ipv4" source address="10.20.30.0/24" service name="http" accept'
```

Ensure SSH stays open:

```bash
firewall-cmd --permanent --add-service=ssh
```

Reload:

```bash
firewall-cmd --reload
```

Verify:

```bash
firewall-cmd --list-rich-rules
```

---

## **C. SELinux verifying**

```bash
getenforce
curl localhost
```

If Apache serves the page and SELinux stays in enforcing ‚Üí passed.

---

# -------------------------------------------------------------

# üî• **2Ô∏è‚É£ Security Troubleshooting Challenge (Exam Difficulty)**

Your server is experiencing multiple access, security, and service issues.
Fix all problems and restore normal behavior **without disabling SELinux**.

---

# **üî∑ Scenario**

1. Users cannot access a custom web directory `/custom/www`.
   Permissions look correct but Apache logs show SELinux denials.
2. Firewalld blocks access to a custom TCP service on port **9090**.
3. SSH refuses password-based login even though config shows:

   ```
   PasswordAuthentication yes
   ```
4. A rich rule allowing `192.168.50.10` was created incorrectly and now blocks all access.

---

# **‚úî Expected Troubleshooting Workflow**

## **1. Fix Apache access**

Check context:

```bash
ls -Z /custom/www
```

Apply correct SELinux type:

```bash
semanage fcontext -a -t httpd_sys_content_t "/custom/www(/.*)?"
restorecon -Rv /custom/www
```

Test:

```bash
curl localhost
```

---

## **2. Open port 9090**

```bash
firewall-cmd --permanent --add-port=9090/tcp
firewall-cmd --reload
```

Verify:

```bash
firewall-cmd --list-ports
```

---

## **3. Fix SSH password login**

Check effective config:

```bash
sshd -T | grep passwordauthentication
```

If it shows ‚Äúno‚Äù, a second config file is overriding it.
Search drop-in configs:

```bash
grep -R "PasswordAuthentication" /etc/ssh
```

Fix override file, then:

```bash
systemctl restart sshd
```

---

## **4. Remove bad rich rule**

View rules:

```bash
firewall-cmd --list-rich-rules
```

Remove incorrect rule:

```bash
firewall-cmd --permanent --remove-rich-rule='<bad rule>'
firewall-cmd --reload
```

Add correct rule:

```bash
firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="192.168.50.10" accept'
firewall-cmd --reload
```

---

# -------------------------------------------------------------

# üî• **3Ô∏è‚É£ 10-Minute Security Mastery Drill**

**Goal:** Complete the following tasks in **10 minutes** or less.
This is intense but great training.

---

# **üî∑ Tasks**

### **1. Allow port 443 permanently.**

### **2. Block all traffic from IP 192.168.1.77.**

### **3. Allow SSH only from 192.168.1.0/24.**

### **4. Set SELinux to enforcing immediately.**

### **5. Assign SELinux type `httpd_sys_rw_content_t` to `/data/upload`.**

### **6. Disable root SSH login.**

### **7. Restart sshd and verify.**

### **8. Show only SELinux denial messages from today.**

---

# **üß† Expected Command Sequence (Fastest Path)**

```bash
# 1
firewall-cmd --permanent --add-service=https
firewall-cmd --reload

# 2
firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="192.168.1.77" drop'
firewall-cmd --reload

# 3
firewall-cmd --permanent --remove-service=ssh
firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="192.168.1.0/24" service name="ssh" accept'
firewall-cmd --reload

# 4
setenforce 1

# 5
semanage fcontext -a -t httpd_sys_rw_content_t "/data/upload(/.*)?"
restorecon -Rv /data/upload

# 6
sed -i 's/^#\?PermitRootLogin.*/PermitRootLogin no/' /etc/ssh/sshd_config

# 7
systemctl restart sshd
sshd -T | grep permitrootlogin

# 8
ausearch -m avc -ts today
```
