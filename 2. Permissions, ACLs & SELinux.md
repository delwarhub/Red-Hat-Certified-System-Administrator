Below you‚Äôll find **clean, exam-style, step-by-step solutions** for *each* Permissions / ACL / SELinux task ‚Äî exactly how you should execute them on a RHEL system during the RHCSA exam.

I‚Äôll also include **verification commands** for each item so you can confirm your work like an examiner.

---

# üîµ **1. Apply ACL so a user has read-only access to a directory**

### **Task Example:**

Give user `bob` **read-only** access to `/data`.

### **Steps**

1. Ensure the directory exists:

```bash
sudo mkdir -p /data
```

2. Apply ACL (read + execute for directory listing):

```bash
sudo setfacl -m u:bob:rx /data
```

### **Verify**

```bash
getfacl /data
```

Expected:

```
user:bob:rx
```

---

# üîµ **2. Set default ACLs on a project folder**

Default ACLs ensure **new files inherit** permissions.

### **Task Example:**

Give group `devteam` full default permissions on `/project`.

### **Steps**

```bash
sudo setfacl -m d:g:devteam:rwx /project
```

You also need normal ACL if they must access existing content:

```bash
sudo setfacl -m g:devteam:rwx /project
```

### **Verify**

```bash
getfacl /project
```

Expected:

```
group:devteam:rwx
default:group:devteam:rwx
```

---

# üîµ **3. Diagnose and fix a permission denied caused by SELinux**

### **Typical exam scenario:**

A service (Apache, FTP, NFS, etc.) cannot access a directory even though UNIX permissions are correct.

### **Steps to diagnose**

1. Check user-facing error
2. Examine SELinux logs:

```bash
sudo ausearch -m avc -ts recent
```

Or more simply:

```bash
sudo journalctl -t setroubleshoot
sudo sealert -a /var/log/audit/audit.log
```

3. If SELinux denies access, check context:

```bash
ls -Z /path/to/dir
```

### **Fix Option 1 ‚Äî apply correct SELinux type**

Example for Apache:

```bash
sudo chcon -t httpd_sys_content_t /path/to/dir
```

### **Fix Option 2 ‚Äî restore expected labels**

```bash
sudo restorecon -Rv /path/to/dir
```

### **Verify**

```bash
ls -Z /path/to/dir
```

Re-test the application (curl, browser, etc.)

---

# üîµ **4. Change SELinux context so Apache can read a directory**

### **Task Example:**

Apache must serve `/webdata`.

Apache-readable context is:

* `httpd_sys_content_t` ‚Üí read-only content
* `httpd_sys_rw_content_t` ‚Üí read+write content

### **Steps (read-only example)**

1. Create directory:

```bash
sudo mkdir -p /webdata
```

2. Give Apache read context:

```bash
sudo semanage fcontext -a -t httpd_sys_content_t "/webdata(/.*)?"
```

3. Apply labeling:

```bash
sudo restorecon -Rv /webdata
```

### **Verify**

```bash
ls -Zd /webdata
```

Expect:

```
system_u:object_r:httpd_sys_content_t:s0
```

---

# üîµ **5. Temporarily set SELinux to permissive, then restore enforcing mode**

### **Steps**

#### **Set to permissive**

```bash
sudo setenforce 0
```

#### **Verify**

```bash
getenforce
```

Should show:

```
Permissive
```

#### **Restore enforcing**

```bash
sudo setenforce 1
```

#### **Verify**

```bash
getenforce
```

Should show:

```
Enforcing
```

**Note:** `setenforce` is temporary ‚Äî does *not* survive reboot.
Permanent change is in `/etc/selinux/config`, but the RHCSA exam does **not** require persistent change.

---

# üîµ **6. Restore default SELinux contexts using restorecon**

### **Task Example:**

You accidentally changed SELinux context of `/var/www/html`.

### **Steps**

```bash
sudo restorecon -Rv /var/www/html
```

### **Verify**

```bash
ls -Z /var/www/html
```

Should now match the expected default context for web content.

---

# üü¢ **Summary Cheat Sheet (Fast Recall)**

| Task                      | Core Command                                              |
| ------------------------- | --------------------------------------------------------- |
| User read-only ACL        | `setfacl -m u:user:rx DIR`                                |
| Default ACL               | `setfacl -m d:g:group:rwx DIR`                            |
| Diagnose SELinux          | `ausearch -m avc -ts recent` / `ls -Z`                    |
| Change to Apache-readable | `semanage fcontext -a -t httpd_sys_content_t "DIR(/.*)?"` |
| Temporary permissive      | `setenforce 0` / `setenforce 1`                           |
| Restore default contexts  | `restorecon -Rv DIR`                                      |

---
Here is a **realistic, challenging, exam-style combined SELinux + ACL scenario**.
This mirrors exactly how Red Hat tests your ability to troubleshoot, apply ACLs, manage contexts, and restore correct SELinux labeling under pressure.

I‚Äôll provide:

1. **The full scenario (as if you are taking the test)**
2. **Step-by-step solution (exam-form)**
3. **Verification steps (to confirm everything works)**

---

# üî• **RHCSA Exam-Style Combined Scenario: SELinux + ACLs**

You are the system administrator for a web development environment. Developers and testers need shared access to certain directories, and Apache must serve files from a location outside the default `/var/www/html`. SELinux is enforcing.

You must complete the following tasks.

---

# **üî∑ Scenario Requirements**

## **1Ô∏è‚É£ Create a directory `/devshare` with these rules:**

* Owned by group **devteam**
* All members of **devteam** have full access
* All new files inherit group automatically
* User **qauser** must have **read-only** ACL access
* No other users may access the directory

---

## **2Ô∏è‚É£ Apache must serve content from `/devshare/webapp`.**

* Ensure Apache has read access
* Ensure SELinux allows this directory to be served
* SELinux must remain **Enforcing**

---

## **3Ô∏è‚É£ A developer reports that Apache returns *403 Forbidden*.**

You must diagnose and fix the issue ‚Äî assume the cause is SELinux-related.

---

## **4Ô∏è‚É£ Reset SELinux contexts under `/devshare` to what you configured permanently.**

---

# -------------------------------------------------

# üß† **Step-by-Step Exam-Style Solution**

---

# **1Ô∏è‚É£ Create `/devshare` with correct ownership + collaboration**

### Create group (if not already created)

```bash
sudo groupadd devteam
```

### Create directory

```bash
sudo mkdir -p /devshare
```

### Set group ownership

```bash
sudo chgrp devteam /devshare
```

### Give group full permissions + SGID

```bash
sudo chmod 2770 /devshare
```

This ensures:

* `rwx` for owner and group
* SGID (`2`) so new files inherit group

---

# **2Ô∏è‚É£ Apply ACLs (including read-only for qauser)**

### Read-only for qauser

```bash
sudo setfacl -m u:qauser:rx /devshare
```

### Default + regular group ACL for devteam

```bash
sudo setfacl -m g:devteam:rwx /devshare
sudo setfacl -m d:g:devteam:rwx /devshare
```

---

# **3Ô∏è‚É£ Prepare Apache content directory**

### Create the directory Apache must serve

```bash
sudo mkdir -p /devshare/webapp
sudo chgrp devteam /devshare/webapp
sudo chmod 2770 /devshare/webapp
```

---

# **4Ô∏è‚É£ Allow Apache to access `/devshare/webapp` using SELinux**

This requires assigning a **persistent SELinux type**.

### Add SELinux rule:

```bash
sudo semanage fcontext -a -t httpd_sys_content_t "/devshare/webapp(/.*)?"
```

### Apply the new context:

```bash
sudo restorecon -Rv /devshare/webapp
```

---

# **5Ô∏è‚É£ Fix the 403 Forbidden error (SELinux troubleshooting)**

Assume Apache is returning 403 even with correct permissions.

### Step 1 ‚Äî Check SELinux denial logs:

```bash
sudo ausearch -m avc -ts recent
# or
sudo journalctl -t setroubleshoot
```

### Step 2 ‚Äî Verify contexts:

```bash
ls -Z /devshare
ls -Z /devshare/webapp
```

If files inside `/devshare/webapp` are **mis-labeled** (common issue), apply:

```bash
sudo restorecon -Rv /devshare
```

### Step 3 ‚Äî Test Apache:

```bash
curl localhost
```

If misconfigured SELinux type was the issue, it is now resolved.

---

# **6Ô∏è‚É£ Reset SELinux contexts for entire `/devshare` tree**

This ensures consistency and correctness in the exam.

```bash
sudo restorecon -Rv /devshare
```

---

# -------------------------------------------------

# üü¢ **Verification Commands**

Use these exactly as an examiner would:

---

## **Verify ACLs**

```bash
getfacl /devshare
```

Expected to see:

* `group:devteam:rwx`
* `default:group:devteam:rwx`
* `user:qauser:rx`

---

## **Verify UNIX permissions**

```bash
ls -ld /devshare
```

Expected:

```
drwxrws---. root devteam /devshare
```

Look for the **`s`** in group permissions.

---

## **Verify Apache SELinux context**

```bash
ls -Z /devshare/webapp
```

Expected:

```
httpd_sys_content_t
```

---

## **Verify SELinux mode**

```bash
getenforce
```

Expected:

```
Enforcing
```

---

## **Verify Apache can read content**

Place a test file:

```bash
echo "Hello RHCSA" | sudo tee /devshare/webapp/index.html
```

Test:

```bash
curl localhost
```

Expected output:

```
Hello RHCSA
```

---


